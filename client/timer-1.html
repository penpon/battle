<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Timer Prototype 1 - Minimal Bar</title>
  <style>
    :root { --bg:#0b1020; --panel:#0f152b; --card:#121a34; --text:#e8ecf7; --muted:#a9b3cf; --ok:#15c57e; --ng:#ff5d5d; --accent:#5b8cff; }
    * { box-sizing: border-box; }
    body { margin:0; min-height:100dvh; color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans JP', sans-serif; background: linear-gradient(180deg, #0a0f20, #0b1226 40%, #0b132a); display:grid; place-items:center; padding:24px; }
    main { width:min(720px, 92vw); }
    .card { background:var(--card); border:1px solid rgba(255,255,255,0.08); border-radius:16px; padding:24px; box-shadow: 0 12px 40px rgba(0,0,0,.35); }
    .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:14px; color:#cfe0ff; }
    .label { font-size:12px; letter-spacing:.2px; color:var(--muted); }
    .time { font-weight:900; font-size:64px; letter-spacing:1px; line-height:1; margin:8px 0 14px; text-shadow:0 6px 24px rgba(0,0,0,.4); }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); font-weight:700; }
    .bar { position:relative; height:14px; background:#0b132a; border:1px solid rgba(255,255,255,.08); border-radius:999px; overflow:hidden; }
    .bar-fill { position:absolute; inset:0 auto 0 0; width:0%; background: linear-gradient(90deg, rgba(91,140,255,.95), rgba(91,140,255,.45)); box-shadow: 0 0 22px rgba(91,140,255,.45); }
    .tick { margin-top:10px; font-size:12px; color:#b8c3e3; display:flex; justify-content:space-between; }
    .hint { margin-top:8px; font-size:11px; color:#8ea0c9; }
  </style>
</head>
<body>
  <main>
    <div class="card" role="timer" aria-live="polite">
      <div class="header">
        <div>
          <div class="label">問題タイマー</div>
          <div style="font-weight:800">Minimal Bar</div>
        </div>
        <div class="pill"><span>初期値</span><span id="initSec">90s</span></div>
      </div>
      <div id="timeText" class="time" aria-label="残り時間">01:30</div>
      <div class="bar" aria-hidden="true">
        <div id="barFill" class="bar-fill"></div>
      </div>
      <div class="tick"><span>残り</span><span id="percent">100%</span></div>
      <div class="hint">?sec=任意秒 で開始秒数を変更できます（既定 90）。</div>
    </div>
  </main>
  <script>
    (function(){
      const qs = new URLSearchParams(location.search);
      const total = Math.max(1, parseInt(qs.get('sec')||'90',10));
      const tEl = document.getElementById('timeText');
      const pEl = document.getElementById('percent');
      const bEl = document.getElementById('barFill');
      const initEl = document.getElementById('initSec');
      initEl.textContent = total + 's';

      const start = performance.now();
      let rafId = 0;
      function fmt(t){
        t = Math.max(0, Math.floor(t));
        const m = String(Math.floor(t/60)).padStart(2,'0');
        const s = String(t%60).padStart(2,'0');
        return m+':'+s;
      }
      function step(now){
        const elapsed = (now - start)/1000;
        const remain = Math.max(0, total - elapsed);
        const pct = Math.max(0, Math.min(1, remain/total));
        tEl.textContent = fmt(remain);
        bEl.style.width = (pct*100).toFixed(2)+'%';
        pEl.textContent = Math.round(pct*100)+'%';
        if(remain>0){ rafId = requestAnimationFrame(step); }
      }
      rafId = requestAnimationFrame(step);
      window.addEventListener('beforeunload',()=>cancelAnimationFrame(rafId));
    })();
  </script>
</body>
</html>
